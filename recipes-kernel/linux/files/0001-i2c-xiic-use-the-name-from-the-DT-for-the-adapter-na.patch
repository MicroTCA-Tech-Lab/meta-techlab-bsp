From 08ad73d0de0aa150cae44c324c2322452b77756b Mon Sep 17 00:00:00 2001
From: Jan Marjanovic <jan.marjanovic@desy.de>
Date: Tue, 11 Jan 2022 13:48:04 +0100
Subject: [PATCH] i2c: xiic: use the name from the DT for the adapter name

---
 drivers/i2c/busses/i2c-xiic.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/i2c/busses/i2c-xiic.c b/drivers/i2c/busses/i2c-xiic.c
index 51c7e4e69ba6..74ff3a09ee36 100644
--- a/drivers/i2c/busses/i2c-xiic.c
+++ b/drivers/i2c/busses/i2c-xiic.c
@@ -1287,6 +1287,7 @@ static int xiic_i2c_probe(struct platform_device *pdev)
 	int ret, irq;
 	u8 i;
 	u32 sr;
+	const char *of_name = NULL;
 
 	i2c = devm_kzalloc(&pdev->dev, sizeof(*i2c), GFP_KERNEL);
 	if (!i2c)
@@ -1317,6 +1318,15 @@ static int xiic_i2c_probe(struct platform_device *pdev)
 	i2c->adap.dev.parent = &pdev->dev;
 	i2c->adap.dev.of_node = pdev->dev.of_node;
 
+	/* set the name of the controller */
+	if (!of_property_read_string(pdev->dev.of_node, "name", &of_name)) {
+		snprintf(i2c->adap.name, sizeof(i2c->adap.name),
+					DRIVER_NAME " [%s]", of_name);
+	} else {
+		dev_warn(&pdev->dev, "could not find the name in the DT, "
+				"using the default value\n");
+	}
+
 	mutex_init(&i2c->lock);
 	init_waitqueue_head(&i2c->wait);
 
-- 
2.25.1

